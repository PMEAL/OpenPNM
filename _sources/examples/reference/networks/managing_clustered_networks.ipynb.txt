{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "cc23f8c3",
   "metadata": {},
   "source": [
    "# Managing Clustered Networks\n",
    "\n",
    "This tutorial will cover the common issue of a network that is \"clustered\", meaning that some pores are not connected the main body of the network. This is fairly common when extracting networks from tomogram, but can occur when getting creative with networks like stitching two together. A clustered network causes problems for the numerical solvers because it leads to \"singular\" matrices (i.e. they cannot be solved). Below we will explain what this means, and how to fix it."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "7ba1bfe5",
   "metadata": {},
   "outputs": [],
   "source": [
    "import openpnm as op\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "7ad276ba",
   "metadata": {},
   "outputs": [],
   "source": [
    "pn = op.network.Demo(shape=[5, 5 ,1])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "83993317",
   "metadata": {},
   "source": [
    "## Creating a Clustered Network\n",
    "\n",
    "Now that we've created a network, lets `trim` some throats to create clusters of isolated pores:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "id": "5077113b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "op.topotools.trim(network=pn, throats=[4, 5, 8, 9, 20, 21, 30, 31])\n",
    "ax = op.visualization.plot_connections(pn)\n",
    "op.visualization.plot_coordinates(pn, ax=ax);"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a5a96ab0",
   "metadata": {},
   "source": [
    "Now we can have 3 total \"clusters\", two small clusters at the bottom plus one large cluster which constitutes the rest of the network. "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2f50a60b",
   "metadata": {},
   "source": [
    "## Illustrating the Problem\n",
    "Let's first see the problem this creates and why. This requires running (or attempting to run) a transport simulation."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "id": "9f42aa0a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "══════════════════════════════════════════════════════════════════════════════\n",
      "phase_01 : <openpnm.phase.Water at 0x23cb60d1a90>\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  #  Properties                                                   Valid Values\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  2  pore.temperature                                                  25 / 25\n",
      "  3  pore.pressure                                                     25 / 25\n",
      "  4  pore.contact_angle                                                25 / 25\n",
      "  5  pore.density                                                      25 / 25\n",
      "  6  pore.molar_density                                                25 / 25\n",
      "  7  pore.surface_tension                                              25 / 25\n",
      "  8  pore.thermal_conductivity                                         25 / 25\n",
      "  9  pore.vapor_pressure                                               25 / 25\n",
      " 10  pore.viscosity                                                    25 / 25\n",
      " 11  throat.hydraulic_conductance                                      32 / 32\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  #  Labels                                                 Assigned Locations\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  2  pore.all                                                               25\n",
      "  3  throat.all                                                             32\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n"
     ]
    }
   ],
   "source": [
    "w = op.phase.Water(network=pn)\n",
    "w.add_model(propname='throat.hydraulic_conductance',\n",
    "            model=op.models.physics.hydraulic_conductance.generic_hydraulic)\n",
    "print(w)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "id": "a931d66b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Your network is clustered, making Ax = b ill-conditioned\n"
     ]
    }
   ],
   "source": [
    "flow = op.algorithms.StokesFlow(network=pn, phase=w)\n",
    "flow.set_value_BC(pores=pn.pores('left'), values=200_000)\n",
    "flow.set_value_BC(pores=pn.pores('right'), values=100_000)\n",
    "try:\n",
    "    flow.run()\n",
    "except Exception as e:\n",
    "    print(e)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c1ec44ef",
   "metadata": {},
   "source": [
    "As we can see above, attempting to run `flow` resulted in an Exception with a message about the matrix being singular. Let's see how a clustered network creates this problem. Let's print the A matrix as an image:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "2d8f0c27",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.image.AxesImage at 0x23cb61fb6a0>"
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAaAAAAGdCAYAAABU0qcqAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjYuMSwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/av/WaAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAXK0lEQVR4nO3dX2yW9f3w8U/5V1BpWUVaOguC/9j8wxIUJOqCs+HPARHlQI0HaIhLXDHBxpiQTFFn0ugSZ1wYnmwyD3TOAzGaJyyuSskywIgxi8nCA/zYAwRbJ3looRsF6fUc7LFbBYb9x6d3+3old0Lv+6LXh8srvL1631zfsqIoigCAC2xM9gAAjE4CBEAKAQIghQABkEKAAEghQACkECAAUggQACnGZQ/wTd3d3XH48OGYPHlylJWVZY8DQB8VRRHHjh2L2traGDPm3Nc5wy5Ahw8fjrq6uuwxABiggwcPxuWXX37O14ddgCZPnhwREf/nkyui4pIL+xPCu6+54YLuD2Ak+ipOxZ/if/X8fX4uwy5AX//YreKSMVEx+cIGaFzZ+Au6P4AR6f/fYfR8b6MM2d/wGzZsiCuuuCImTpwYCxYsiI8++miodgVACRqSAL355pvR2NgY69evj08++STmzp0bS5YsiS+++GIodgdACRqSAL344ovx8MMPx0MPPRTf//7345VXXomLLroofvOb3wzF7gAoQYMeoJMnT8auXbuivr7+3zsZMybq6+tj+/btZ2zf1dUVHR0dvR4AjHyDHqAvv/wyTp8+HdXV1b2er66ujtbW1jO2b2pqisrKyp6Hj2ADjA7pd0JYt25dtLe39zwOHjyYPRIAF8Cgfwx76tSpMXbs2Ghra+v1fFtbW9TU1JyxfXl5eZSXlw/2GAAMc4N+BTRhwoSYN29eNDc39zzX3d0dzc3NsXDhwsHeHQAlakj+IWpjY2OsWrUqbrrpppg/f3689NJL0dnZGQ899NBQ7A6AEjQkAbr33nvj73//ezz11FPR2toaP/jBD2LLli1nfDABgNGrrCiKInuI/9TR0RGVlZXxf//37At+K54ltT+4oPsDGIm+Kk7F1ngn2tvbo6Ki4pzbDbt7wWX6w+FP+/X7hAug79I/hg3A6CRAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUAgRAimG7HMPd19wQ48rG9/n39XdJhYEYyD5LcSkHy1YAg8EVEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkGLY3g27vwZyx2V30h7a/ZbinxUYOq6AAEghQACkECAAUggQACkECIAUAgRACgECIIUAAZBCgABIIUAApBAgAFIIEAApBAiAFAIEQIoRtxzDQGQsMzCaZC2VYSkHGJ5cAQGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUlmMYBFm3+x9NSxRYygFGHldAAKQQIABSCBAAKQY9QE8//XSUlZX1esyZM2ewdwNAiRuSDyFcd9118cc//vHfOxnnsw4A9DYkZRg3blzU1NQMxbcGYIQYkveA9uzZE7W1tTF79ux44IEH4sCBA+fctqurKzo6Ono9ABj5Bj1ACxYsiE2bNsWWLVti48aNsX///rj99tvj2LFjZ92+qakpKisrex51dXWDPRIAw1BZURTFUO7g6NGjMXPmzHjxxRdj9erVZ7ze1dUVXV1dPV93dHREXV1dLIq7YlzZ+KEcreT5B5bfjuMEF9ZXxanYGu9Ee3t7VFRUnHO7If90wJQpU+Kaa66JvXv3nvX18vLyKC8vH+oxABhmhvzfAR0/fjz27dsX06dPH+pdAVBCBj1Ajz/+eLS0tMTf/va3+POf/xx33313jB07Nu6///7B3hUAJWzQfwR36NChuP/+++PIkSNx2WWXxW233RY7duyIyy67bLB3BUAJG/QA/e53vxvsbwnACOQWBSXMEgXfjuMEw5ObkQKQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUlmP4D/299X4p3nY/a4mC/so6xhnHqRTPJ+gPV0AApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKd8P+D/29C/FA7g7tzsffTikeY+cT/HeugABIIUAApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKyzEMgoHcAr8Ub72fsczAaDLazidGL1dAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUAgRACgECIIXlGJKNplvvZ93uv9SO00CU2ryMbq6AAEghQACkECAAUvQ5QNu2bYvly5dHbW1tlJWVxebNm3u9XhRFPPXUUzF9+vSYNGlS1NfXx549ewZrXgBGiD4HqLOzM+bOnRsbNmw46+svvPBCvPzyy/HKK6/Ezp074+KLL44lS5bEiRMnBjwsACNHnz8Ft2zZsli2bNlZXyuKIl566aX46U9/GnfddVdERLz22mtRXV0dmzdvjvvuu29g0wIwYgzqe0D79++P1tbWqK+v73musrIyFixYENu3bz/r7+nq6oqOjo5eDwBGvkENUGtra0REVFdX93q+urq657VvampqisrKyp5HXV3dYI4EwDCV/im4devWRXt7e8/j4MGD2SMBcAEMaoBqamoiIqKtra3X821tbT2vfVN5eXlUVFT0egAw8g1qgGbNmhU1NTXR3Nzc81xHR0fs3LkzFi5cOJi7AqDE9flTcMePH4+9e/f2fL1///749NNPo6qqKmbMmBFr166N5557Lq6++uqYNWtWPPnkk1FbWxsrVqwYzLkBKHF9DtDHH38cd9xxR8/XjY2NERGxatWq2LRpUzzxxBPR2dkZP/7xj+Po0aNx2223xZYtW2LixImDNzUAJa/PAVq0aFEURXHO18vKyuLZZ5+NZ599dkCDATCyWY6hhI2mpRwGwnGC4Sn9Y9gAjE4CBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUAgRACgECIIUAAZBCgABIIUAApLAcwyiVsURBKS5PkLWUQ3+V4jEeTecTvbkCAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUrgbNn3W37sQD+Tu0O58/O2U4jF2Po1eroAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUAgRACssxcMEM5Bb4pXjr/YxlBkaT0XY+jUSugABIIUAApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKyzFQEkbTLfCz/qxZy0Bk/Hkt5TA8uAICIIUAAZBCgABI0ecAbdu2LZYvXx61tbVRVlYWmzdv7vX6gw8+GGVlZb0eS5cuHax5ARgh+hygzs7OmDt3bmzYsOGc2yxdujQ+//zznscbb7wxoCEBGHn6/Cm4ZcuWxbJly/7rNuXl5VFTU9PvoQAY+YbkPaCtW7fGtGnT4tprr41HHnkkjhw5cs5tu7q6oqOjo9cDgJFv0AO0dOnSeO2116K5uTmef/75aGlpiWXLlsXp06fPun1TU1NUVlb2POrq6gZ7JACGoUH/h6j33Xdfz69vuOGGuPHGG+PKK6+MrVu3xp133nnG9uvWrYvGxsaerzs6OkQIYBQY8o9hz549O6ZOnRp79+496+vl5eVRUVHR6wHAyDfkATp06FAcOXIkpk+fPtS7AqCE9PlHcMePH+91NbN///749NNPo6qqKqqqquKZZ56JlStXRk1NTezbty+eeOKJuOqqq2LJkiWDOjgApa3PAfr444/jjjvu6Pn66/dvVq1aFRs3boy//OUv8dvf/jaOHj0atbW1sXjx4vjZz34W5eXlgzc1ACWvzwFatGhRFEVxztf/8Ic/DGggAEYHyzEAqfq7vEHW0gaWchg8bkYKQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUliOAYaIZQaGVikubZBxjIfzMg6ugABIIUAApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBRlRVEU2UP8p46OjqisrIxFcVeMKxufPQ5ccKV4l+eByLiT9kCU2jHOOJ++Kk7F1ngn2tvbo6Ki4pzbuQICIIUAAZBCgABIIUAApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKcZlDwD0NpDb/ZfiUg793W+pLeOQJeN86jjWHd+55vzbuQICIIUAAZBCgABIIUAApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKSzHACPIaFrKIWv5iKxlIErpGH9VnIqI/znvdq6AAEghQACkECAAUvQpQE1NTXHzzTfH5MmTY9q0abFixYrYvXt3r21OnDgRDQ0Ncemll8Yll1wSK1eujLa2tkEdGoDS16cAtbS0RENDQ+zYsSPef//9OHXqVCxevDg6Ozt7tnnsscfi3XffjbfeeitaWlri8OHDcc899wz64ACUtj59Cm7Lli29vt60aVNMmzYtdu3aFT/84Q+jvb09fv3rX8frr78eP/rRjyIi4tVXX43vfe97sWPHjrjlllsGb3IAStqA3gNqb2+PiIiqqqqIiNi1a1ecOnUq6uvre7aZM2dOzJgxI7Zv337W79HV1RUdHR29HgCMfP0OUHd3d6xduzZuvfXWuP766yMiorW1NSZMmBBTpkzptW11dXW0trae9fs0NTVFZWVlz6Ourq6/IwFQQvodoIaGhvjss8/id7/73YAGWLduXbS3t/c8Dh48OKDvB0Bp6NedENasWRPvvfdebNu2LS6//PKe52tqauLkyZNx9OjRXldBbW1tUVNTc9bvVV5eHuXl5f0ZA4AS1qcroKIoYs2aNfH222/HBx98ELNmzer1+rx582L8+PHR3Nzc89zu3bvjwIEDsXDhwsGZGIARoU9XQA0NDfH666/HO++8E5MnT+55X6eysjImTZoUlZWVsXr16mhsbIyqqqqoqKiIRx99NBYuXOgTcAD00qcAbdy4MSIiFi1a1Ov5V199NR588MGIiPjFL34RY8aMiZUrV0ZXV1csWbIkfvWrXw3KsACMHH0KUFEU591m4sSJsWHDhtiwYUO/hwJg5LMcAxARo2sph1LU32M8nI+vm5ECkEKAAEghQACkECAAUggQACkECIAUAgRACgECIIUAAZBCgABIIUAApBAgAFIIEAApBAiAFJZjAAYsYymHrGUGspatyNjnUB9jV0AApBAgAFIIEAApBAiAFAIEQAoBAiCFAAGQQoAASCFAAKQQIABSCBAAKQQIgBQCBECKsqIoiuwh/lNHR0dUVlbGorgrxpWNzx4HGKaG812eh0LGnbT7q+NYd3znmv+J9vb2qKioOOd2roAASCFAAKQQIABSCBAAKQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUAgRAinHZAwD0x0CWVCjFpRz6u9/hvIyDKyAAUggQACkECIAUAgRACgECIIUAAZBCgABIIUAApBAgAFIIEAApBAiAFAIEQAoBAiDFsLsbdlEUERHxVZyKKJKHAUakjmPd/f69XxWnBnGSoTeQP2u/93n8X/v8+u/zcykrzrfFBXbo0KGoq6vLHgOAATp48GBcfvnl53x92AWou7s7Dh8+HJMnT46ysrIzXu/o6Ii6uro4ePBgVFRUJExYGhynb8dxOj/H6NtxnP6tKIo4duxY1NbWxpgx536nZ9j9CG7MmDH/tZhfq6ioGPX/kb8Nx+nbcZzOzzH6dhynf6msrDzvNj6EAEAKAQIgRckFqLy8PNavXx/l5eXZowxrjtO34zidn2P07ThOfTfsPoQAwOhQcldAAIwMAgRACgECIIUAAZCipAK0YcOGuOKKK2LixImxYMGC+Oijj7JHGlaefvrpKCsr6/WYM2dO9ljptm3bFsuXL4/a2tooKyuLzZs393q9KIp46qmnYvr06TFp0qSor6+PPXv25Ayb6HzH6cEHHzzj/Fq6dGnOsImampri5ptvjsmTJ8e0adNixYoVsXv37l7bnDhxIhoaGuLSSy+NSy65JFauXBltbW1JEw9fJROgN998MxobG2P9+vXxySefxNy5c2PJkiXxxRdfZI82rFx33XXx+eef9zz+9Kc/ZY+UrrOzM+bOnRsbNmw46+svvPBCvPzyy/HKK6/Ezp074+KLL44lS5bEiRMnLvCkuc53nCIili5d2uv8euONNy7ghMNDS0tLNDQ0xI4dO+L999+PU6dOxeLFi6Ozs7Nnm8ceeyzefffdeOutt6KlpSUOHz4c99xzT+LUw1RRIubPn180NDT0fH369Omitra2aGpqSpxqeFm/fn0xd+7c7DGGtYgo3n777Z6vu7u7i5qamuLnP/95z3NHjx4tysvLizfeeCNhwuHhm8epKIpi1apVxV133ZUyz3D2xRdfFBFRtLS0FEXxr/Nn/PjxxVtvvdWzzV//+tciIort27dnjTkslcQV0MmTJ2PXrl1RX1/f89yYMWOivr4+tm/fnjjZ8LNnz56ora2N2bNnxwMPPBAHDhzIHmlY279/f7S2tvY6tyorK2PBggXOrbPYunVrTJs2La699tp45JFH4siRI9kjpWtvb4+IiKqqqoiI2LVrV5w6darXOTVnzpyYMWOGc+obSiJAX375ZZw+fTqqq6t7PV9dXR2tra1JUw0/CxYsiE2bNsWWLVti48aNsX///rj99tvj2LFj2aMNW1+fP86t81u6dGm89tpr0dzcHM8//3y0tLTEsmXL4vTp09mjpenu7o61a9fGrbfeGtdff31E/OucmjBhQkyZMqXXts6pMw27u2HTf8uWLev59Y033hgLFiyImTNnxu9///tYvXp14mSMBPfdd1/Pr2+44Ya48cYb48orr4ytW7fGnXfemThZnoaGhvjss8+819pPJXEFNHXq1Bg7duwZnyJpa2uLmpqapKmGvylTpsQ111wTe/fuzR5l2Pr6/HFu9d3s2bNj6tSpo/b8WrNmTbz33nvx4Ycf9lpCpqamJk6ePBlHjx7ttb1z6kwlEaAJEybEvHnzorm5uee57u7uaG5ujoULFyZONrwdP3489u3bF9OnT88eZdiaNWtW1NTU9Dq3Ojo6YufOnc6t8zh06FAcOXJk1J1fRVHEmjVr4u23344PPvggZs2a1ev1efPmxfjx43udU7t3744DBw44p76hZH4E19jYGKtWrYqbbrop5s+fHy+99FJ0dnbGQw89lD3asPH444/H8uXLY+bMmXH48OFYv359jB07Nu6///7s0VIdP3681/+l79+/Pz799NOoqqqKGTNmxNq1a+O5556Lq6++OmbNmhVPPvlk1NbWxooVK/KGTvDfjlNVVVU888wzsXLlyqipqYl9+/bFE088EVdddVUsWbIkceoLr6GhIV5//fV45513YvLkyT3v61RWVsakSZOisrIyVq9eHY2NjVFVVRUVFRXx6KOPxsKFC+OWW25Jnn6Yyf4YXl/88pe/LGbMmFFMmDChmD9/frFjx47skYaVe++9t5g+fXoxYcKE4rvf/W5x7733Fnv37s0eK92HH35YRMQZj1WrVhVF8a+PYj/55JNFdXV1UV5eXtx5553F7t27c4dO8N+O0z/+8Y9i8eLFxWWXXVaMHz++mDlzZvHwww8Xra2t2WNfcGc7RhFRvPrqqz3b/POf/yx+8pOfFN/5zneKiy66qLj77ruLzz//PG/oYcpyDACkKIn3gAAYeQQIgBQCBEAKAQIghQABkEKAAEghQACkECAAUggQACkECIAUAgRACgECIMX/A4b8+cwZ+X23AAAAAElFTkSuQmCC\n",
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "plt.imshow(flow.A.todense() != 0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fcf84750",
   "metadata": {},
   "source": [
    "Referring to the network visualization above we can see that pores 5 and 10 are connected to each other, but not to any other pores. Looking at the A matrix above we can this reflected in the pattern. We can see that on row 5 there is an entry in the diagonal (5, 5) and a second entry at column 10 (5, 10). Now looking at row 10 we see an entry on the diagonal (10, 10) and a entry at column 5 (10, 5). These off-diagonal entries represent the conductance values between pores 5 and 10 (and between 10 and 5). The key point to note is that NO OTHER entries are present on either row. This means that the mass balance equations for pores 5 and 10 are not coupled to the rest of the equations. Another way to say is that pores 5 and 10 form their own independent matrix which can be solved in isolation since they don't exchange mass with any of the other pores...however, we can't solve this 'mini-system' because we have not specified any boundary conditions for it.  "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7a175a25",
   "metadata": {},
   "source": [
    "## Fixing Clustered Networks\n",
    "\n",
    "This is easy to see by eye, but we need to tell OpenPNM to find them so we can begin to fix the problem. In version 3 we added many new pore-scale models to the ``models.network`` libary, among them are `cluster_number` and `cluster_size`.  Let's add these two models to the network and see what we get:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "9fd43314",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "══════════════════════════════════════════════════════════════════════════════\n",
      "net : <openpnm.network.Demo at 0x23cae22bc70>\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  #  Properties                                                   Valid Values\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  2  pore.coords                                                       25 / 25\n",
      "  3  throat.conns                                                      32 / 32\n",
      "  4  pore.coordination_number                                          25 / 25\n",
      "  5  pore.max_size                                                     25 / 25\n",
      "  6  throat.spacing                                                    32 / 32\n",
      "  7  pore.seed                                                         25 / 25\n",
      "  8  pore.diameter                                                     25 / 25\n",
      "  9  throat.max_size                                                   32 / 32\n",
      " 10  throat.diameter                                                   32 / 32\n",
      " 11  throat.cross_sectional_area                                       32 / 32\n",
      " 12  throat.hydraulic_size_factors                                     32 / 32\n",
      " 13  throat.diffusive_size_factors                                     32 / 32\n",
      " 14  throat.lens_volume                                                32 / 32\n",
      " 15  throat.length                                                     32 / 32\n",
      " 16  throat.total_volume                                               32 / 32\n",
      " 17  throat.volume                                                     32 / 32\n",
      " 18  pore.volume                                                       25 / 25\n",
      " 19  pore.cluster_number                                               25 / 25\n",
      " 20  pore.cluster_size                                                 25 / 25\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  #  Labels                                                 Assigned Locations\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n",
      "  2  pore.surface                                                           16\n",
      "  3  throat.surface                                                         14\n",
      "  4  pore.left                                                               5\n",
      "  5  pore.right                                                              5\n",
      "  6  pore.front                                                              5\n",
      "  7  pore.back                                                               5\n",
      "――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n"
     ]
    }
   ],
   "source": [
    "pn.add_model(propname='pore.cluster_number',\n",
    "             model=op.models.network.cluster_number)\n",
    "pn.add_model(propname='pore.cluster_size',\n",
    "             model=op.models.network.cluster_size)\n",
    "print(pn)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "caae6fe7",
   "metadata": {},
   "source": [
    "We can see that cluster number and size have been added to the list of properties.  Let's inspect them:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "800998f9",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([0., 0., 0., 0., 0., 1., 2., 0., 0., 0., 1., 2., 0., 0., 0., 0., 0.,\n",
       "       0., 0., 0., 0., 0., 0., 0., 0.])"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pn['pore.cluster_number']"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0aa0bc39",
   "metadata": {},
   "source": [
    "We can see that most pores a labeled 0, meaning they belong to cluster 0. However, there are a few with cluster numbers of 1 and  2, which we know correspond to the two small clusters in our network.  We *could* solve our current problem by trimming these pores, but let's do it the proper way. Had we not looked at the network visualization, We would not actually know that cluster 0 is the *main* cluster.  We can look at the *size* of each cluster instead:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "fa7b1ab5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([21., 21., 21., 21., 21.,  2.,  2., 21., 21., 21.,  2.,  2., 21.,\n",
       "       21., 21., 21., 21., 21., 21., 21., 21., 21., 21., 21., 21.])"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pn['pore.cluster_size']"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2f929b5c",
   "metadata": {},
   "source": [
    "Now we can see that most pores belong to a large cluster of size 21, where there are a few on small clusters. Now we can clearly tell which pores should be trimmed:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "103c8bc8",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "Ps = pn['pore.cluster_size'] < 21\n",
    "op.topotools.trim(network=pn, pores=Ps)\n",
    "ax = op.visualization.plot_connections(pn)\n",
    "op.visualization.plot_coordinates(pn, ax=ax);"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5d8a8ed9",
   "metadata": {},
   "source": [
    "Now we can see only a single cluster.  Without even re-running the pore-scale models we can see that the pores with a cluster number other than 0 have been removed:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "8175d00d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,\n",
       "       0., 0., 0., 0.])"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pn['pore.cluster_number']"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
