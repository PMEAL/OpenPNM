
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Predicting dispersion coefficient &#8212; OpenPNM 2.8.2.dev111140 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/custom.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    <img src="../../_static/openpnm_logo.jpg" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/openpnm_logo.jpg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../basic_usage.html">
  Basic Usage
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../modules/index.html">
  Module Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../examples/index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../examples/index2.html">
  Examples2
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PMEAL/OpenPNM/issues">Issue Tracker<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PMEAL/OpenPNM/discussions">Get Help<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Quick Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PMEAL/OpenPNM" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/OpenPNM" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generating-network-and-phase">
   Generating Network and phase
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-effective-pore-volume">
   Defining Effective Pore Volume
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#perform-stokes-flow">
   Perform Stokes flow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apply-transient-advection-diffusion">
   Apply transient advection diffusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#elution-curve">
   Elution curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-for-the-dispersion-coefficient">
   Solving for the dispersion coefficient
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section class="tex2jax_ignore mathjax_ignore" id="predicting-dispersion-coefficient">
<h1>Predicting dispersion coefficient<a class="headerlink" href="#predicting-dispersion-coefficient" title="Permalink to this heading">#</a></h1>
<p>This example will show how to find the dispersion coefficient of a porous medium. The following equation given by <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/B9780120218073500084%5D">Fried and Combarnous (1971)</a> is used to solve the longitudinal dispersion coefficient:</p>
<div class="math notranslate nohighlight">
\[\frac{C}{C_{0}} = \frac{1}{2}erfc\Bigl(\frac{x-Ut}{2(D_{L}t)^{\frac{1}{2}}}\Bigr)+\frac{1}{2}exp\Bigl(\frac{Ux}{D_{L}}\Bigl)erfc\Bigr(\frac{x+Ut}{2(D_{L}t)^{\frac{1}{2}}}\Bigr)\]</div>
<p>Where <span class="math notranslate nohighlight">\(x\)</span> is the length between the inlet and the outlet, <span class="math notranslate nohighlight">\(t\)</span> is the time, <span class="math notranslate nohighlight">\(D_{L}\)</span> is the longitudinal dispersion coefficient, <span class="math notranslate nohighlight">\(U\)</span> is the average pore velocity, <span class="math notranslate nohighlight">\(C_{0}\)</span> is the inlet concentration, and <span class="math notranslate nohighlight">\(C\)</span> is the concentration at the given time. <span class="math notranslate nohighlight">\(erfc\)</span> is the complementary error function. In this example we implement a transient advection diffusion algorithm to fit the data to the equation above and find the value of <span class="math notranslate nohighlight">\(D_{L}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openpnm</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_formats = [&#39;svg&#39;]
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="generating-network-and-phase">
<h2>Generating Network and phase<a class="headerlink" href="#generating-network-and-phase" title="Permalink to this heading">#</a></h2>
<p>First, we create a network and assign the phase and properties in a similar way that we used to do for the other examples. A 2D <code class="docutils literal notranslate"><span class="pre">Cubic</span></code> network is generated here, but a 3D network would work as well. Note that <code class="docutils literal notranslate"><span class="pre">op.models.collections.phase</span></code> is added to assign fluid properties such as viscosity, etc, and <code class="docutils literal notranslate"><span class="pre">op.models.collections.physics</span></code> is added to assign pore-scale models such as entry pressure, conduit conductance. A user-defined value for water diffusivity was assumed, as it is not included in <code class="docutils literal notranslate"><span class="pre">collections.phase.water</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">pn</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Cubic</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">spheres_and_cylinders</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">Water</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">pn</span><span class="p">)</span>
<span class="n">water</span><span class="p">[</span><span class="s1">&#39;pore.diffusivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">water</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">standard</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [2],</span> in <span class="ni">&lt;cell line: 5&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">pn</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">spheres_and_cylinders</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">pn</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">water</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">Water</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">pn</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">water</span><span class="p">[</span><span class="s1">&#39;pore.diffusivity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">water</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">water</span><span class="p">)</span>

<span class="nn">File ~/work/OpenPNM/OpenPNM/openpnm/phase/_water.py:27,</span> in <span class="ni">Water.__init__</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">27</span>     <span class="kn">from</span> <span class="nn">thermo</span> <span class="kn">import</span> <span class="n">Chemical</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">Chemical</span><span class="p">(</span><span class="s1">&#39;h2o&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">temp</span> <span class="o">=</span> <span class="n">_fetch_chemical_props</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;thermo&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-effective-pore-volume">
<h2>Defining Effective Pore Volume<a class="headerlink" href="#defining-effective-pore-volume" title="Permalink to this heading">#</a></h2>
<p>The accumulation of mass in the network occurs only in the pores, where the concentration is solved.  In order for mass  accumulate properly, it is necessary to assign the throat volumes to their surrounded throats.  This creates an effective pore volume.  We can define this in a custom pore-scale model, making use of the <code class="docutils literal notranslate"><span class="pre">numpy.add.at</span></code> function, to add 1/2 the volume of each throat to its neighboring pores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">effective_pore_volume</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">throat_volume</span><span class="o">=</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">,</span> <span class="n">pore_volume</span><span class="o">=</span><span class="s1">&#39;pore.volume&#39;</span><span class="p">):</span>
    <span class="n">Pvol</span> <span class="o">=</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.volume&#39;</span><span class="p">]</span>
    <span class="n">Tvol</span> <span class="o">=</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">]</span>
    <span class="n">Vtot</span> <span class="o">=</span> <span class="n">Pvol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">Tvol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">Pvol</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">Pvol</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">Pvol</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">Vtot</span><span class="p">)</span>  <span class="c1"># Ensure total volume has been added to Pvol</span>
    <span class="k">return</span> <span class="n">Pvol</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.effective_volume&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">effective_pore_volume</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-stokes-flow">
<h2>Perform Stokes flow<a class="headerlink" href="#perform-stokes-flow" title="Permalink to this heading">#</a></h2>
<p>The advection diffusion algorithm assumes a velocity field. Therefore, Stokes flow in the pore netwok is solved prior to running the <code class="docutils literal notranslate"><span class="pre">AdvectionDiffusion</span></code> algorthim. Note that we updated the phase property after based on pressure distribution from stokes flow results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sf</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">StokesFlow</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">water</span><span class="p">)</span>
<span class="n">sf</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;back&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>
<span class="n">sf</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sf</span><span class="o">.</span><span class="n">run</span><span class="p">();</span>
<span class="n">water</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;pore.pressure&#39;</span><span class="p">:</span><span class="n">sf</span><span class="p">[</span><span class="s1">&#39;pore.pressure&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                       
</pre></div>
</div>
</div>
</div>
</section>
<section id="apply-transient-advection-diffusion">
<h2>Apply transient advection diffusion<a class="headerlink" href="#apply-transient-advection-diffusion" title="Permalink to this heading">#</a></h2>
<p>An algorthim for transient advection diffusion is defined here for a range of timesteps. We must also tell the algorithm to use the effective pore volume rather than the default which is just <code class="docutils literal notranslate"><span class="pre">pore.volume</span></code>. Here, the solution is saved at intervals of 5 through the integration time span <code class="docutils literal notranslate"><span class="pre">tspan</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">ad_dif_conductance</span><span class="o">.</span><span class="n">ad_dif</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.ad_dif_conductance&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span> <span class="n">s_scheme</span><span class="o">=</span><span class="s1">&#39;powerlaw&#39;</span><span class="p">)</span>
<span class="n">ad</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">TransientAdvectionDiffusion</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">water</span><span class="p">)</span>
<span class="n">ad</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">_update</span><span class="p">({</span><span class="s1">&#39;pore.volume&#39;</span> <span class="p">:</span> <span class="s1">&#39;pore.effective_volume&#39;</span><span class="p">})</span>
<span class="n">inlet</span>  <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;back&#39;</span><span class="p">)</span> 
<span class="n">outlet</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">)</span>
<span class="n">ad</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">inlet</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">ad</span><span class="o">.</span><span class="n">set_outflow_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">outlet</span><span class="p">)</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">saveat</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">soln</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tspan</span><span class="o">=</span><span class="n">tspan</span><span class="p">,</span> <span class="n">saveat</span><span class="o">=</span><span class="n">saveat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="elution-curve">
<h2>Elution curve<a class="headerlink" href="#elution-curve" title="Permalink to this heading">#</a></h2>
<p>To plot the elution curve from simulation data, we calculate the average concentration at each time step in the <code class="docutils literal notranslate"><span class="pre">soln</span></code> as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ps_front</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">([</span><span class="s1">&#39;front&#39;</span><span class="p">])</span>
<span class="n">Ts_front</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">find_neighbor_throats</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">Ps_front</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;xor&#39;</span><span class="p">)</span>
<span class="n">steps</span> <span class="o">=</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">saveat</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c_avg</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">soln</span><span class="p">[</span><span class="s1">&#39;pore.concentration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">:</span>
    <span class="n">c_front</span> <span class="o">=</span> <span class="n">soln</span><span class="p">[</span><span class="s1">&#39;pore.concentration&#39;</span><span class="p">](</span><span class="n">ti</span><span class="p">)[</span><span class="n">Ps_front</span><span class="p">]</span>
    <span class="n">q_front</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">rate</span><span class="p">(</span><span class="n">throats</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">Ts</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">)[</span><span class="n">Ts_front</span><span class="p">]</span>
    <span class="n">c_avg</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">q_front</span><span class="o">*</span><span class="n">c_front</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">q_front</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>    
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">soln</span><span class="p">[</span><span class="s1">&#39;pore.concentration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">c_avg</span><span class="p">,</span> <span class="s2">&quot;o-&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;fitted&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;concentration&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8e0c77cb43d708d3c0a5b4e0f9c5c0429630f4d35263a52ca7fcddb0901be3c7.svg" src="../../_images/8e0c77cb43d708d3c0a5b4e0f9c5c0429630f4d35263a52ca7fcddb0901be3c7.svg" /></div>
</div>
</section>
<section id="solving-for-the-dispersion-coefficient">
<h2>Solving for the dispersion coefficient<a class="headerlink" href="#solving-for-the-dispersion-coefficient" title="Permalink to this heading">#</a></h2>
<p>Since we will define the inlet concentration as being equal to 1, solving for <span class="math notranslate nohighlight">\(C\)</span> is effictivly equal to solving for <span class="math notranslate nohighlight">\(\frac{C}{C_{0}}\)</span>.</p>
<p>We create a function for elution for curve fitting of solution data to the function. The known values are time and concentration found from the transport solution. From curve fittiong, the values of <span class="math notranslate nohighlight">\(D_{L}\)</span> and <span class="math notranslate nohighlight">\(U\)</span> will be found.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">elution</span><span class="p">(</span><span class="n">step</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">DL</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">40</span><span class="o">*</span><span class="mf">1e-4</span>
    <span class="n">el1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">step</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">DL</span><span class="o">*</span><span class="n">step</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))))</span>
    <span class="n">el2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">DL</span><span class="p">)</span>
    <span class="n">el3</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">DL</span><span class="o">*</span><span class="n">step</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">el1</span><span class="o">+</span><span class="n">el2</span><span class="o">*</span><span class="n">el3</span>
</pre></div>
</div>
</div>
</div>
<p>Here we calculate the average velocity (v_pred) to compare with the value found from curve fitting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q_throat</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">rate</span><span class="p">(</span><span class="n">throats</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">Ts</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">)</span>
<span class="n">A_throat</span> <span class="o">=</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.cross_sectional_area&#39;</span><span class="p">]</span>
<span class="n">v_throat</span> <span class="o">=</span> <span class="n">q_throat</span><span class="o">/</span><span class="n">A_throat</span>
<span class="n">v_pred</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">q_throat</span><span class="o">*</span><span class="n">v_throat</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">q_throat</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="n">v_pred</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">]</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">soln</span><span class="p">[</span><span class="s1">&#39;pore.concentration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">ydata</span> <span class="o">=</span> <span class="n">c_avg</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s apply a curve fitting to concentration vs time data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">elution</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
<span class="n">disp_coeff</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">v_fit</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dispersion Coefficient = &#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0:.4E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">disp_coeff</span><span class="p">),</span> <span class="s1">&#39; m^2/s&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_pred = &#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0:.4E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_pred</span><span class="p">),</span> <span class="s1">&#39; m/s&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_fitted = &#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0:.4E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_fit</span><span class="p">),</span> <span class="s1">&#39; m/s&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dispersion Coefficient =  7.6581E-09  m^2/s
v_pred =  2.3610E-04  m/s
v_fitted =  7.0669E-05  m/s
</pre></div>
</div>
</div>
</div>
<p>Now we can visualize the fitted curve and original data from simulation. The values of concentration vs time from fitted curve and the values from simulation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)):</span>
    <span class="n">el</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">elution</span><span class="p">(</span><span class="n">xdata</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;simulation&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;fitted&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;concentration&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8a77542ae85a28ecb7e4b4eff50748d8dbf299972a11d38dbe58569e6dc71f31.svg" src="../../_images/8a77542ae85a28ecb7e4b4eff50748d8dbf299972a11d38dbe58569e6dc71f31.svg" /></div>
</div>
</section>
</section>


              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PMEAL.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>