
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Assigning Geometric Properties &#8212; OpenPNM 2.8.2.dev111140 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/js/custom.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using Labels and Defining Domains" href="06_labels_and_domains.html" />
    <link rel="prev" title="Network Representation, Queries, and Manipulation" href="04_graph_queries_and_manipulation.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    <img src="../../_static/openpnm_logo.jpg" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/openpnm_logo.jpg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../basic_usage.html">
  Basic Usage
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../modules/index.html">
  Module Reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../examples/index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../examples/index_old.html">
  Examples (old)
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PMEAL/OpenPNM/issues">Issue Tracker<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PMEAL/OpenPNM/discussions">Get Help<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Quick Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PMEAL/OpenPNM" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/OpenPNM" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../examples/tutorials.html">
   10 Steps to Learn OpenPNM
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01_numerical_python_primer.html">
     Numerical Python Primer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_network_generation_and_visualization.html">
     Generating Networks and Quick Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_data_and_topology_storage.html">
     Storage of Network Data and Topology
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_graph_queries_and_manipulation.html">
     Network Representation, Queries, and Manipulation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Assigning Geometric Properties
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06_labels_and_domains.html">
     Using Labels and Defining Domains
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07_phases_and_mixtures.html">
     Using Basic Phases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08_simulating_transport.html">
     Simulating Single Phase Transport
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09_simulating_invasion.html">
     Simulating Invasion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_visualization_options.html">
     Visualization options
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../examples/metrics.html">
   Metrics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../examples/reference.html">
   Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/architecture/settings_attribute_machinery.html">
     Settings Attribute Machinery
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/architecture/workspace_and_projects.html">
     The Workspace and Projects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/simulations/available_matrix_solvers.html">
     Available Matrix Solvers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/simulations/basic_transport.html">
     Steady State Transport
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/simulations/reactive_transport.html">
     Basic Transport
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/simulations/size_factors_and_transport_conductance.html">
     Size Factors and Transport Conductance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/simulations/transient_transport.html">
     Basic Transport
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manually-calculating-properties">
   Manually Calculating Properties
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-pore-and-throat-sizes-from-scipy-stats-distributions">
     Adding pore and throat sizes from
     <code class="docutils literal notranslate">
      <span class="pre">
       scipy.stats
      </span>
     </code>
     distributions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-throat-length">
     Computing throat length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-pore-surface-areas">
     Computing pore surface areas
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-pore-scale-models-from-the-library">
   Using Pore-scale Models from the Library
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-predefined-collections-of-models">
   Using Predefined Collections of Models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#customizing-models-by-overwriting-them-or-their-arguments">
   Customizing Models by Overwriting Them or Their Arguments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction-to-the-dependency-handler">
   Introduction to the Dependency Handler
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section class="tex2jax_ignore mathjax_ignore" id="assigning-geometric-properties">
<h1>Assigning Geometric Properties<a class="headerlink" href="#assigning-geometric-properties" title="Permalink to this heading">#</a></h1>
<p>Geometric properties refer to the physical sizes of the pores and throats, such as pore diameter and throat lengths. The values are essential to the pore network modeling enterprize since they control all the transport and percolation behavior of the network. Unlike phase properties which can be normalized for, geometric properties define the network even more so than topological properties like connectivity.</p>
<p>Geometric properties <em>can</em> be calculated by various means, ranging from assigning random values to pores, extracting values from tomographic images. OpenPNM provides a library of functions, or ‘pore-scale models’ which can calcuate these geometric properties automatically. This tutorial will cover the following subjects:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Subject</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Manually Calculating Pore and Throat Properties (⚠ Not Recommended!)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Using Pore-scale Models from the Library</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Overview of the Dependency Handler</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Using Predefined Collections of Models</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Defining Heterogeneous Domains (by Applying Models to Specific Locations)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Customizing Models (by Overwriting Them or Their Arguments)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Writing and Using Custom Models</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">openpnm</span> <span class="k">as</span> <span class="nn">op</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start by creating a blank Cubic network.  As we can see by printing it, there only coordinates, connections, and some labels, but no geometric properties:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pn</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Cubic</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>══════════════════════════════════════════════════════════════════════════════
net : &lt;openpnm.network.Cubic at 0x7f36f43f0db0&gt;
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  #  Properties                                                   Valid Values
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  1  pore.coords                                                   8000 / 8000
  2  throat.conns                                                22800 / 22800
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  #  Labels                                                 Assigned Locations
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  1  pore.back                                                             400
  2  pore.bottom                                                           400
  3  pore.front                                                            400
  4  pore.left                                                             400
  5  pore.right                                                            400
  6  pore.surface                                                         2168
  7  pore.top                                                              400
  8  throat.surface                                                       4332
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
</pre></div>
</div>
</div>
</div>
<p>.. attention:: Changed in V3</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>In OpenPNM V3 we have removed the concept of ``Geometry`` and ``Physics`` objects, in favor of placing all the properties on the ``Network`` and ``Phase`` objects instead. 
</pre></div>
</div>
<p>To add geometrical properties to a network, we have a few different options.  Each will be explored below:</p>
<section id="manually-calculating-properties">
<h2>Manually Calculating Properties<a class="headerlink" href="#manually-calculating-properties" title="Permalink to this heading">#</a></h2>
<p>.. warning:: Manual Calculation is Not Recommended</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This is not the preferred way to do things, but does illustrate the processes very well. The preferred way is using pore-scale models, which allow for the automatic regeneration of dependent properities when something changes. 
</pre></div>
</div>
<p>Let’s start by adding pore and throat size distributions.  There are a few different ways to do this, and we’ll explore each one to be thorough.</p>
<section id="adding-pore-and-throat-sizes-from-scipy-stats-distributions">
<h3>Adding pore and throat sizes from <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> distributions<a class="headerlink" href="#adding-pore-and-throat-sizes-from-scipy-stats-distributions" title="Permalink to this heading">#</a></h3>
<p>Scipy’s <code class="docutils literal notranslate"><span class="pre">stats</span></code> module has a <em>lot</em> of statistical distributions defined.  Let’s generate pore and throat sizes using some of these.  First, let’s use a normal distribution to generate pore sizes within the range ~1 to 50 um:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">spst</span>
<span class="n">psd</span> <span class="o">=</span> <span class="n">spst</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">psd</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f38f32940b49d9462536df0506ede27b99bc754304c19872caacd60c67b95983.png" src="../../_images/f38f32940b49d9462536df0506ede27b99bc754304c19872caacd60c67b95983.png" />
</div>
</div>
<p>The above distribution looks good, let’s just make absolutely sure that our distribution is not so wide that it has negative numbers or values greater than 50 um:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.5593961722893255
47.80996128980269
</pre></div>
</div>
</div>
</div>
<p>Now we’ll convert these values to SI and assign to the network:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd</span><span class="o">*</span><span class="mf">1e-6</span>  <span class="c1"># um to m</span>
</pre></div>
</div>
</div>
</div>
<p>Next we need to define throat diameters. We can do this in the same way, but let’s use a different distribution.  Note that this approach is not recommended because as we’ll see it results in throats that are larger than the two pores they are connected two.  We’ll fix this in the following section:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tsd</span> <span class="o">=</span> <span class="n">spst</span><span class="o">.</span><span class="n">weibull_min</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tsd</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1f4313c746b7c36e51585262f35d6349638a40db32ec0d6047826af131a78554.png" src="../../_images/1f4313c746b7c36e51585262f35d6349638a40db32ec0d6047826af131a78554.png" />
</div>
</div>
<p>Again, let’s inspect the high and low values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tsd</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tsd</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5130345457395142
36.96861960231873
</pre></div>
</div>
</div>
</div>
<p>So we can see that we have throats as small as 500 nm, and as large as 37 um.  These can be assigned to the network as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsd</span><span class="o">*</span><span class="mf">1e-6</span>  <span class="c1"># um to m</span>
</pre></div>
</div>
</div>
</div>
<p>The problem with this approach is that both pore and throat sizes were just assigned to random locations, rather than putting small throats between small pores and vice-versa. When throats are larger than the pores they connect it can cause problems or strangeness in the results since we generally assume a throat is a constriction between two pores.  Let’s count how many are problematic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">][</span><span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">&lt;</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hits</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>564
</pre></div>
</div>
</div>
</div>
<p>.. tip:: Indexing pore properties by <code class="docutils literal notranslate"><span class="pre">conns</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Using the ``conns`` array to index into a pore property returns an Nt-by-2 array with the properties of the pores on the end of a throat in each column.  For instance, so see the diameter of the pore on each end of a throat, use ``pn[&#39;pore.diameter&#39;][pn.conns]``.  This approach is very powerful.  If you ever feel tempted to use a for-loop to scan over each pore, then inspect the properties of the neighboring throats, consider instead if you can &quot;loop&quot; over the throats then interogate each pore.  If yes, then you can use this conns-indexing trick.
</pre></div>
</div>
<p>There are two <em>safer</em> ways to assign pore and throat sizes, to ensure that throats are smaller than the pores they connected.  The first is to proceed as above by assign pore sizes randomly, <em>then</em> assigning throats to be the <em>as small (or smaller) as the smallest pore it is connected to</em>.  This can be done using some <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functions as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">][</span><span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tsd</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/63be7b04798da164e6e615ca62fa1b7e93f1029ecd48982caef0ac3e82895daf.png" src="../../_images/63be7b04798da164e6e615ca62fa1b7e93f1029ecd48982caef0ac3e82895daf.png" />
</div>
</div>
<p>We can see from the above plot that the throat sizes are similar to the pore sizes, which is expected since they are taken from the pore sizes values. However, we can also see a small shift to the left, which is also expected given that the throats always take on the size of the smaller pore, creating a bias towards smaller sizes.</p>
<p>It may also be desirable to force the throats to be smaller than the two neighboring pores by some factor:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsd</span><span class="o">*</span><span class="mf">0.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1303bd30c451bf4a9f936a23cc04ad604f4d4ffd647174857bcf9288b70fbfa7.png" src="../../_images/1303bd30c451bf4a9f936a23cc04ad604f4d4ffd647174857bcf9288b70fbfa7.png" />
</div>
</div>
<p>One downside of the above approach is that you no longer have control over the shape and distribution of the throat sizes. This can be solved by applying the same approach just described but to random seeds instead of actual sizes. Then the random seeds can be put into a cumulative density function to compute the corresponding size.  This is demonstrated below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span>
<span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">+</span> <span class="n">lo</span>
</pre></div>
</div>
</div>
</div>
<p>.. tip::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Setting the `lo` and `hi` values of the the seeds prevents values that lie far out in the tail of a distribution from occurring which can lead to overly large pores or throats.
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ppf</span></code> function, or <em>point probability function</em> returns the value of a cumulative distribution at the given probability, so the seed values computed above can be related to size values using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">spst</span>
<span class="n">psd</span> <span class="o">=</span> <span class="n">spst</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">])</span>
<span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd</span><span class="o">*</span><span class="mf">1e-6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1e82a5e1a4fe020e880b8794773fc00a3091387edac842a1148e9e54ac16fa38.png" src="../../_images/1e82a5e1a4fe020e880b8794773fc00a3091387edac842a1148e9e54ac16fa38.png" />
</div>
</div>
<p>Now we can find the throat seed values as the <em>minimum pore seed</em> value of the two neighboring pores:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">][</span><span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And then we can use these seed values in the <code class="docutils literal notranslate"><span class="pre">ppf</span></code> function of the desired distribution. So long as the distribution does not create larger values than the distribution used to compute pore sizes, then the throat sizes will always be smaller.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tsd</span> <span class="o">=</span> <span class="n">spst</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.seed&#39;</span><span class="p">])</span>
<span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsd</span><span class="o">*</span><span class="mf">1e-6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0d5f4a45771cc756801c26a74daf0e0c4c7635235c5378919042f99601874f8d.png" src="../../_images/0d5f4a45771cc756801c26a74daf0e0c4c7635235c5378919042f99601874f8d.png" />
</div>
</div>
<p>Once the pore and throat diameters are specified, the next step is to define any dependent properties of interest, such as pore volume or throat length. These additional calculations tend to require that we assume a shape for the pores and throats.  It is not mandatory to use spheres and cylinders, though this is a common choice.  We could also work with cubic pores and cuboid throats, which occupy a large volume fraction for instance.  The choice of cubic shapes also happens to make the calculations much easier, for reasons explored below, so in this tutorial we’ll assume cubic shapes.  Let’s calculate the throat length, and pore surface area, since each of these illustrate very important concepts regarding the use of vectorized calculations.</p>
</section>
<section id="computing-throat-length">
<h3>Computing throat length<a class="headerlink" href="#computing-throat-length" title="Permalink to this heading">#</a></h3>
<p>Throat length is the pore-to-pore spacing, less the radius of each pore.  This can be found without the need for a for-loop using the following vectorization trick:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">][</span><span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">L_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Lt</span> <span class="o">=</span> <span class="n">L_total</span> <span class="o">-</span> <span class="n">R1</span> <span class="o">-</span> <span class="n">R2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L_total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5.e-05 5.e-05 5.e-05 ... 5.e-05 5.e-05 5.e-05]
</pre></div>
</div>
</div>
</div>
<p>The above cell contains 3 complicated but powerful steps:</p>
<ol class="arabic simple">
<li><p>The radii of the pores on each end of each throat are retrieved. <code class="docutils literal notranslate"><span class="pre">R1</span></code> and <code class="docutils literal notranslate"><span class="pre">R2</span></code> contain duplicates since each pore has numerous throats, so they appear once for each throat. This fact is used in step 3.</p></li>
<li><p>The pore-to-pore distance is found by retrieving the coordinates of each pore, in the same was as was done for the radii. The Euclidean distance between each pair of pores is then computed by finding their difference (<code class="docutils literal notranslate"><span class="pre">np.diff</span></code>), squaring it, summing it (<code class="docutils literal notranslate"><span class="pre">np.sum</span></code>), then taking the square root (<code class="docutils literal notranslate"><span class="pre">np.sqrt</span></code>) of each. The <code class="docutils literal notranslate"><span class="pre">axis</span></code> argument is used throughout to tell numpy which way to apply the operation. This line is an example of how you must learn a <em>mini-language</em> to use numpy effectively.</p></li>
<li><p>The length of each throat is found as the spacing between pores, less the radii the pore on each end. This is where the duplicate values in <code class="docutils literal notranslate"><span class="pre">R1</span></code> and <code class="docutils literal notranslate"><span class="pre">R2</span></code> are necessary, since the radii of pore <em>i</em> must be subtracted from length of each of it’s neighboring throats.</p></li>
</ol>
<p>The main take-home message here is that throat properties can be computed in a vectorized way, even if some pore-properties are required. This avoids the use of a for-loop to scan through a list of throats followed by a nested for-loop to scan through each neighboring pore.</p>
</section>
<section id="computing-pore-surface-areas">
<h3>Computing pore surface areas<a class="headerlink" href="#computing-pore-surface-areas" title="Permalink to this heading">#</a></h3>
<p>The pore surface area is the total area of the cubic pore body, less the cross-sectional area of each neighboring throat. This can also be found without a for-loop, but requires knowing some deeper <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functionality, known as <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.at.html">unbuffered in-place operations</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">At</span> <span class="o">=</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">SAp</span> <span class="o">=</span> <span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">6</span>
<span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">SAp</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">At</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">SAp</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">conns</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">At</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SAp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[9.08485305e-10 5.68134509e-09 2.33947201e-09 ... 6.57211706e-10
 1.92152447e-09 1.72429278e-09]
</pre></div>
</div>
</div>
</div>
<p>The above cell contains 2 lines of importance, which each do almost the same thing:</p>
<ol class="arabic simple">
<li><p>The first line subtracts the throat cross-sectional area from each pore listed in the first column of the <code class="docutils literal notranslate"><span class="pre">pn.conns</span></code> array. Since a given pore is connected to potentially many throats, the subtraction must be done using <code class="docutils literal notranslate"><span class="pre">np.substract.at</span></code> which is a special version of the subtract function that subtracts every value in <code class="docutils literal notranslate"><span class="pre">At</span></code> from the locations in <code class="docutils literal notranslate"><span class="pre">SAp</span></code> indicated by <code class="docutils literal notranslate"><span class="pre">pn.conn[:,</span> <span class="pre">0]</span></code>, and it does so in a cumulative fashion. Thus if pore <em>i</em> appears in <code class="docutils literal notranslate"><span class="pre">pn.conns[:,</span> <span class="pre">0]</span></code> more than once, then more than one value of <code class="docutils literal notranslate"><span class="pre">At</span></code> is removed. The operation is performed <em>in-place</em> so that no array is returned.</p></li>
<li><p>Recall that <code class="docutils literal notranslate"><span class="pre">pn.conns</span></code> contains only the upper-triangular entries of the adjacency matrix, so this process only gets half of the connections. This means that the pore connectioned found in <code class="docutils literal notranslate"><span class="pre">pn.conns[:,</span> <span class="pre">1]</span></code> must also be analyzed.</p></li>
</ol>
</section>
</section>
<section id="using-pore-scale-models-from-the-library">
<h2>Using Pore-scale Models from the Library<a class="headerlink" href="#using-pore-scale-models-from-the-library" title="Permalink to this heading">#</a></h2>
<p>The above section is quite lengthy, but lays bare the process of computing geometric properties of a network for illustration purposes.  In this section we’ll utilize OpenPNM’s library of ‘pore-scale’ models to get the same job done much more easily. Start by generating a fresh network:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pn</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Cubic</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First let’s assign a random number to each pore, but instead of using <code class="docutils literal notranslate"><span class="pre">np.random.rand</span></code> directly, we’ll use a pore-scale model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">pore_seed</span><span class="o">.</span><span class="n">random</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">,</span> 
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Seed value provided to numpy&#39;s random number generator.</span>
             <span class="n">num_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">],)</span>
</pre></div>
</div>
</div>
</div>
<p>.. note:: Where do models go?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>We&#39;ll look more closely at models later in this tutorial, but it&#39;s worth pointing out that the `add_model` method collects all the arguments provided and stores them in the `models` attribute of the object. Later, when `regenerate_models` is called, it looks into the `models` attribute and fetches the model (`f`) and the given arguments, calls the function, collects the returned result, and stores them in `pn[propname]`. You can see a list of models applied to the object with `print(pn.models)`. 
</pre></div>
</div>
<p>Let’s have each throat inherit the minimum seed value found in each of its neighboring pores, for which OpenPNM provides a model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_seed</span><span class="o">.</span><span class="n">from_neighbor_pores</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.seed&#39;</span><span class="p">,</span> 
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">prop</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">,</span>
             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>.. tip:: Using shift-tab to see the docstring</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>In the above two code blocks the models were assigned to `f` first, then `f` was passed to the `model` argument. This is helpful for two reasons.  (1) It helps keep the line length below Python&#39;s preferred limit of 78 characters, and (2) it makes it possible to see the docstring of the model by putting the cursor at the end of the first line and hitting `shift-tab`. Seeing the docstring really helps to understand what a model does and what arguments are required.
</pre></div>
</div>
<p>Now we can compute pore and throat sizes from distributions, which are also provided as OpenPNM models:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">pore_size</span><span class="o">.</span><span class="n">normal</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">scale</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> 
             <span class="n">loc</span><span class="o">=</span><span class="mf">2.5e-5</span><span class="p">,</span>
             <span class="n">seeds</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/30af1e43bb25aad829b7654cde94b7d2e501a59df505822cb091fb1daccac8a0.png" src="../../_images/30af1e43bb25aad829b7654cde94b7d2e501a59df505822cb091fb1daccac8a0.png" />
</div>
</div>
<p>And similarly we fetch a model for the throat sizes as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_size</span><span class="o">.</span><span class="n">normal</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">scale</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> 
             <span class="n">loc</span><span class="o">=</span><span class="mf">2.5e-5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/871f2190a8497a2d446973ee5623c8a5f821e1f8b2b0835ab88661f30b3d2e55.png" src="../../_images/871f2190a8497a2d446973ee5623c8a5f821e1f8b2b0835ab88661f30b3d2e55.png" />
</div>
</div>
<p>Now that we have pore and throat sizes, we can compute their volumes (and other properties). The volume will depend on the shape of the pores and throats.  In OpenPNM we do not explicitly track such <em>shapes</em>.  Instead we offer several models that calculate the property of interest for a given shape. This is illustrated below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_length</span><span class="o">.</span><span class="n">spheres_and_cylinders</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.length&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">pore_volume</span><span class="o">.</span><span class="n">sphere</span> 
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.volume&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f1</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_volume</span><span class="o">.</span><span class="n">cylinder</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>.. warning:: Spherical pores overlap with their throats</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>A spherical pore will always have a region of overlap with it&#39;s connected throats. The volume of this region will be double counted if an extra step is not taken. 
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_length</span><span class="o">.</span><span class="n">spheres_and_cylinders</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.length&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">pore_volume</span><span class="o">.</span><span class="n">sphere</span> 
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.volume&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f1</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_volume</span><span class="o">.</span><span class="n">cylinder</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.total_volume&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f2</span><span class="p">)</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_volume</span><span class="o">.</span><span class="n">lens</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.lens_volume&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f3</span><span class="p">)</span>
<span class="n">f4</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">difference</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f4</span><span class="p">,</span>
             <span class="n">props</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;throat.total_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;throat.lens_volume&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We can inspect some of these values to make sure they are making sense:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Volumes of full throats:&quot;</span><span class="p">,</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.total_volume&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Volumes of lenses:&quot;</span><span class="p">,</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.lens_volume&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Actual throat volumes:&quot;</span><span class="p">,</span> <span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.volume&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Volumes of full throats: [4.06671058e-12 4.49724923e-12 4.03844746e-12]
Volumes of lenses: [6.92245838e-15 8.40091924e-15 7.59556144e-15]
Actual throat volumes: [4.05978813e-12 4.48884831e-12 4.03085190e-12]
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-predefined-collections-of-models">
<h2>Using Predefined Collections of Models<a class="headerlink" href="#using-predefined-collections-of-models" title="Permalink to this heading">#</a></h2>
<p>The process of selecting all the correct models from the <code class="docutils literal notranslate"><span class="pre">models</span></code> library can be tedious and error prone. In OpenPNM V3 we have introduced the concept of model <em>collections</em>, which are predfined dictionaries of models that form a complete and correct geometry. For instance, there is a collection called <code class="docutils literal notranslate"><span class="pre">spheres_and_cylinders</span></code>, which contains all the needed models to describe this geometry.</p>
<p>These collections are found under <code class="docutils literal notranslate"><span class="pre">openpnm.models.collections</span></code>, and their use is outlined below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Cubic</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The models <em>collection</em> is fetched as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">mods</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">spheres_and_cylinders</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">mods</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;pore.diameter&#39;: {&#39;model&#39;: &lt;function product at 0x7f36b2ada940&gt;,
                   &#39;props&#39;: [&#39;pore.max_size&#39;, &#39;pore.seed&#39;]},
 &#39;pore.max_size&#39;: {&#39;iters&#39;: 10,
                   &#39;model&#39;: &lt;function largest_sphere at 0x7f36b0cb3700&gt;},
 &#39;pore.seed&#39;: {&#39;element&#39;: &#39;pore&#39;,
               &#39;model&#39;: &lt;function random at 0x7f36b2ada160&gt;,
               &#39;num_range&#39;: [0.2, 0.7],
               &#39;seed&#39;: None},
 &#39;pore.volume&#39;: {&#39;model&#39;: &lt;function sphere at 0x7f36b0cb3b80&gt;,
                 &#39;pore_diameter&#39;: &#39;pore.diameter&#39;},
 &#39;throat.cross_sectional_area&#39;: {&#39;model&#39;: &lt;function cylinder at 0x7f36b0cbb9d0&gt;,
                                 &#39;throat_diameter&#39;: &#39;throat.diameter&#39;},
 &#39;throat.diameter&#39;: {&#39;factor&#39;: 0.5,
                     &#39;model&#39;: &lt;function scaled at 0x7f36b2ada9d0&gt;,
                     &#39;prop&#39;: &#39;throat.max_size&#39;},
 &#39;throat.diffusive_size_factors&#39;: {&#39;model&#39;: &lt;function spheres_and_cylinders at 0x7f36b0c08dc0&gt;,
                                   &#39;pore_diameter&#39;: &#39;pore.diameter&#39;,
                                   &#39;throat_diameter&#39;: &#39;throat.diameter&#39;},
 &#39;throat.hydraulic_size_factors&#39;: {&#39;model&#39;: &lt;function spheres_and_cylinders at 0x7f36b0c7f5e0&gt;,
                                   &#39;pore_diameter&#39;: &#39;pore.diameter&#39;,
                                   &#39;throat_diameter&#39;: &#39;throat.diameter&#39;},
 &#39;throat.length&#39;: {&#39;model&#39;: &lt;function spheres_and_cylinders at 0x7f36b0cc23a0&gt;,
                   &#39;pore_diameter&#39;: &#39;pore.diameter&#39;,
                   &#39;throat_diameter&#39;: &#39;throat.diameter&#39;},
 &#39;throat.lens_volume&#39;: {&#39;model&#39;: &lt;function lens at 0x7f36b0c49670&gt;,
                        &#39;pore_diameter&#39;: &#39;pore.diameter&#39;,
                        &#39;throat_diameter&#39;: &#39;throat.diameter&#39;},
 &#39;throat.max_size&#39;: {&#39;mode&#39;: &#39;min&#39;,
                     &#39;model&#39;: &lt;function from_neighbor_pores at 0x7f36b2adab80&gt;,
                     &#39;prop&#39;: &#39;pore.diameter&#39;},
 &#39;throat.total_volume&#39;: {&#39;model&#39;: &lt;function cylinder at 0x7f36b0c494c0&gt;,
                         &#39;throat_diameter&#39;: &#39;throat.diameter&#39;,
                         &#39;throat_length&#39;: &#39;throat.length&#39;},
 &#39;throat.volume&#39;: {&#39;model&#39;: &lt;function difference at 0x7f36b2ada5e0&gt;,
                   &#39;props&#39;: [&#39;throat.total_volume&#39;, &#39;throat.lens_volume&#39;]}}
</pre></div>
</div>
</div>
</div>
<p>The print-out of the dictionary is not very nice, but it can be seen that the keys are the model names, and the values are the model itself and the various arguments for the model.  This dictionary can be added to the network using the <code class="docutils literal notranslate"><span class="pre">add_models_collection</span></code> method as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">mods</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>══════════════════════════════════════════════════════════════════════════════
net : &lt;openpnm.network.Cubic at 0x7f36a38dbae0&gt;
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  #  Properties                                                   Valid Values
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  1  pore.coordination_number                                      8000 / 8000
  2  pore.coords                                                   8000 / 8000
  3  pore.diameter                                                 8000 / 8000
  4  pore.max_size                                                 8000 / 8000
  5  pore.seed                                                     8000 / 8000
  6  pore.volume                                                   8000 / 8000
  7  throat.conns                                                22800 / 22800
  8  throat.cross_sectional_area                                 22800 / 22800
  9  throat.diameter                                             22800 / 22800
 10  throat.diffusive_size_factors                               22800 / 22800
 11  throat.hydraulic_size_factors                               22800 / 22800
 12  throat.length                                               22800 / 22800
 13  throat.lens_volume                                          22800 / 22800
 14  throat.max_size                                             22800 / 22800
 15  throat.spacing                                              22800 / 22800
 16  throat.total_volume                                         22800 / 22800
 17  throat.volume                                               22800 / 22800
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  #  Labels                                                 Assigned Locations
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
  1  pore.back                                                             400
  2  pore.bottom                                                           400
  3  pore.domain_1                                                        8000
  4  pore.front                                                            400
  5  pore.left                                                             400
  6  pore.right                                                            400
  7  pore.surface                                                         2168
  8  pore.top                                                              400
  9  throat.domain_1                                                     22800
 10  throat.surface                                                       4332
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
</pre></div>
</div>
</div>
</div>
</section>
<section id="customizing-models-by-overwriting-them-or-their-arguments">
<h2>Customizing Models by Overwriting Them or Their Arguments<a class="headerlink" href="#customizing-models-by-overwriting-them-or-their-arguments" title="Permalink to this heading">#</a></h2>
<p>The pre-written models and collections included with OpenPNM are helpful, but you’ll almost always want to adjust some of the models to suit a specific application. This can be done by either altering the arguments of existing models, or by overwriting them all together.</p>
<p>Let’s first look at replacing a model with one of our choice.  The <code class="docutils literal notranslate"><span class="pre">spheres_and_cylinders</span></code> collection uses a random distribution of pore sizes, bounded between 0 and the distance to the nearest neighbor. This can be inspected by printing the specific model as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;pore.diameter@domain_1&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
Property Name             Parameter                 Value
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
pore.diameter             model:                    product
                          props:                    [&#39;pore.max_size&#39;, &#39;pore.seed&#39;]
                          regeneration mode:        deferred
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
</pre></div>
</div>
</div>
</div>
<p>.. note:: The &#64; Notation</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The @domain_1 that has been added to the model name is new in Version 3 and means that this model should be applied to pore that have the label `&#39;pore.domain_1&#39;`. This will be explained in detail in the next tutorial. 
</pre></div>
</div>
<p>Let’s replace this with a normal distribution. This can be done with the <code class="docutils literal notranslate"><span class="pre">add_model</span></code> method as before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">pore_size</span><span class="o">.</span><span class="n">normal</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">scale</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> 
             <span class="n">loc</span><span class="o">=</span><span class="mf">2.5e-5</span><span class="p">,</span>
             <span class="n">seeds</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now print the model again to ensure it was updated:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;pore.diameter@domain_1&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
Property Name             Parameter                 Value
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
pore.diameter             model:                    normal
                          scale:                    1e-05
                          loc:                      2.5e-05
                          seeds:                    pore.seed
                          regeneration mode:        normal
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
</pre></div>
</div>
</div>
</div>
<p>And let’s inspect the values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/494daf39e106652462444c1b0626ba9ef16a795b2610f5278b3476cfbb92d555.png" src="../../_images/494daf39e106652462444c1b0626ba9ef16a795b2610f5278b3476cfbb92d555.png" />
</div>
</div>
<p>This distribution is quite truncated, due to the <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> values that were used.  Let’s reach into that model and change this.  First print the model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;pore.seed@domain_1&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
Property Name             Parameter                 Value
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
pore.seed                 model:                    random
                          element:                  pore
                          num_range:                [0.2, 0.7]
                          seed:                     None
                          regeneration mode:        deferred
――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
</pre></div>
</div>
</div>
</div>
<p>We can see that the <code class="docutils literal notranslate"><span class="pre">num_range</span></code> argument is quite constrained, so let’s change it. Each model is itself a dictionary, so we can overwrite as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="s1">&#39;pore.seed@domain_1&#39;</span><span class="p">][</span><span class="s1">&#39;num_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]</span>
<span class="n">pn</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f14f3376d45ccf8307ea8a50217eb7d548716857518c3d5dfd1bae5b9b475b5f.png" src="../../_images/f14f3376d45ccf8307ea8a50217eb7d548716857518c3d5dfd1bae5b9b475b5f.png" />
</div>
</div>
</section>
<section id="introduction-to-the-dependency-handler">
<h2>Introduction to the Dependency Handler<a class="headerlink" href="#introduction-to-the-dependency-handler" title="Permalink to this heading">#</a></h2>
<p>Pore-scale models clearly make life easier since you don’t have to produce the complex numpy functions by hand each time, but this is not even their best feature. The main benefit of pore-scale models is that they can be <em>recomputed</em> automatically. For instance, if we re-run the <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> model, then all the other models that depend on <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> will automatically be reomcomputed as well. This all occurs when we call <code class="docutils literal notranslate"><span class="pre">regenerate_models</span></code>, as demonstrated below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Cubic</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">pore_seed</span><span class="o">.</span><span class="n">random</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;pore.diameter&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">scale</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> 
             <span class="n">loc</span><span class="o">=</span><span class="mf">2.5e-5</span><span class="p">,</span>
             <span class="n">seeds</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.seed&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">throat_seed</span><span class="o">.</span><span class="n">from_neighbor_pores</span><span class="p">,</span>
             <span class="n">prop</span><span class="o">=</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">propname</span><span class="o">=</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
             <span class="n">scale</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> 
             <span class="n">loc</span><span class="o">=</span><span class="mf">2.5e-5</span><span class="p">,</span>
             <span class="n">seeds</span><span class="o">=</span><span class="s1">&#39;throat.seed&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.15319619 0.0328116  0.2287953  ... 0.23887453 0.8411705  0.10988224]
[6.59011212e-06 6.59011212e-06 1.75717988e-05 ... 1.13561876e-05
 2.66940036e-05 1.27284536e-05]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;pore.seed&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="s1">&#39;throat.diameter&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.36618201 0.35063831 0.40236746 ... 0.58822388 0.42461491 0.9016327 ]
[2.11640227e-05 2.11640227e-05 2.20171387e-05 ... 2.57748463e-05
 2.30989878e-05 3.79091080e-05]
</pre></div>
</div>
</div>
</div>
<p>As we can see above the initial values of <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> and <code class="docutils literal notranslate"><span class="pre">'throat.diameter'</span></code> are both changed after calling <code class="docutils literal notranslate"><span class="pre">regenerate_models()</span></code>. OpenPNM does this automaticall by inspecting the arguments to each function.</p>
<p>Inspecting the <code class="docutils literal notranslate"><span class="pre">add_model</span></code> calls above we can see:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">'throat.seed'</span></code> model takes <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> as an argument</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">'throat.diameter'</span></code> model takes <code class="docutils literal notranslate"><span class="pre">'throat.seed'</span></code> as an argument</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">'pore.diameter'</span></code> models takes <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> as an argument</p></li>
</ol>
<p>So when <code class="docutils literal notranslate"><span class="pre">regenerate_models</span></code> is called it first re-runs the <code class="docutils literal notranslate"><span class="pre">'pore.seed'</span></code> model, which has no dependencies, then it re-runs the <code class="docutils literal notranslate"><span class="pre">'throat.seed'</span></code> model, then <code class="docutils literal notranslate"><span class="pre">'throat.diameter'</span></code>, in that order based on their dependencies. It also calls <code class="docutils literal notranslate"><span class="pre">'pore.diameter'</span></code>, but no other models depend on this. The dependency handling is done by creating a graph or network using <code class="docutils literal notranslate"><span class="pre">networkx</span></code> then do a special sort to find the top of the tree and all the downstream dependencies.  This can be roughly visualized using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">dependency_map</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;planar&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ed5e85a91556eac347b285576c34a69effd7da7c3d1ada6096bf15beab3e3549.png" src="../../_images/ed5e85a91556eac347b285576c34a69effd7da7c3d1ada6096bf15beab3e3549.png" />
</div>
</div>
<p>The green circles are pore properties and the orange squares are throat properties. We can also see that there are two models which are not dependent on anything else: <code class="docutils literal notranslate"><span class="pre">'throat.spacing'</span></code> and <code class="docutils literal notranslate"><span class="pre">'pore.coordination_number'</span></code>.  These are added to all networks during generation but not run, hence their values do no show up when doing <code class="docutils literal notranslate"><span class="pre">print(pn)</span></code>.</p>
<p>It is also possible to make your own plot if you wish, by retrieving the dependency graph then calling the <code class="docutils literal notranslate"><span class="pre">networkx</span></code> plotting function of your choice:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">dependency_graph</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_planar</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a32cf209098377c3da29088d4bc6635fcf6018607c922b42f82fcd0d97b52b61.png" src="../../_images/a32cf209098377c3da29088d4bc6635fcf6018607c922b42f82fcd0d97b52b61.png" />
</div>
</div>
</section>
</section>


              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PMEAL.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>