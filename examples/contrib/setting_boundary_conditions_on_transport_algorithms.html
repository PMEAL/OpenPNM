
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Adding, Removing, and Changing Boundary Conditions &#8212; OpenPNM 2.8.2.dev111140 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/js/custom.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    <img src="../../_static/openpnm_logo.jpg" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/openpnm_logo.jpg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class=" collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../basic_usage.html">
  Basic Usage
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../modules/index.html">
  Module Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../_examples/index.html">
  Examples
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PMEAL/OpenPNM/issues">Issue Tracker<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PMEAL/OpenPNM/discussions">Get Help<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Quick Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PMEAL/OpenPNM" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initialize-a-transport-algorithm">
   Initialize a Transport Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-value-boundary-conditions">
   Setting Value Boundary Conditions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-rate-boundary-conditions">
   Adding Rate Boundary Conditions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removing-and-resetting-boundary-conditions">
   Removing and Resetting Boundary Conditions
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section class="tex2jax_ignore mathjax_ignore" id="adding-removing-and-changing-boundary-conditions">
<h1>Adding, Removing, and Changing Boundary Conditions<a class="headerlink" href="#adding-removing-and-changing-boundary-conditions" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openpnm</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>Start by creating a basic ‘demo’ network and phase object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Demo</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">Water</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">pn</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_model_collection</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">standard</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">regenerate_models</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
  - WARNING: throat.electrical_conductance was not run since
             the following property is missing:
             &#39;throat.electrical_conductivity&#39; 
  - SOURCE : openpnm.core._base2.regenerate_models 
  - TIME   : 2022-09-07 03:19:33,279    
------------------------------------------------------------
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
  - WARNING: throat.diffusive_conductance was not run since
             the following property is missing:
             &#39;throat.diffusivity&#39; 
  - SOURCE : openpnm.core._base2.regenerate_models 
  - TIME   : 2022-09-07 03:19:33,288    
------------------------------------------------------------
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
  - WARNING: throat.ad_dif_conductance was not run since the
             following property is missing:
             &#39;throat.diffusive_conductance&#39; 
  - SOURCE : openpnm.core._base2.regenerate_models 
  - TIME   : 2022-09-07 03:19:33,290    
------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<section id="initialize-a-transport-algorithm">
<h2>Initialize a Transport Algorithm<a class="headerlink" href="#initialize-a-transport-algorithm" title="Permalink to this heading">#</a></h2>
<p>Now initialize a transport algorithm, in this case diffusion:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">FickianDiffusion</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">pn</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">water</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>All transport algorithms have two arrays pre-defined on them for storing <strong>rate</strong> and <strong>value</strong> boundary conditions, <code class="docutils literal notranslate"><span class="pre">'pore.bc.rate'</span></code> and <code class="docutils literal notranslate"><span class="pre">'pore.bc.value'</span></code>. They both initially contain all <code class="docutils literal notranslate"><span class="pre">nans</span></code> which is interpreted to mean no boundary conditions are applied in the corresponding pores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.rate&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
<p><strong>Pro Tip</strong>: Omitting the trailing part of a dictionary key will result in the return of a sub-dictionary containing any arrays who have the requested prefix. This can be used to fetch a dictionary containing all available boundary conditions using <code class="docutils literal notranslate"><span class="pre">fd['pore.bc']</span></code> as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;rate&#39;, &#39;value&#39;])
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-value-boundary-conditions">
<h2>Setting Value Boundary Conditions<a class="headerlink" href="#setting-value-boundary-conditions" title="Permalink to this heading">#</a></h2>
<p>We can apply ‘value’ or ‘Dirchlet’ boundary conditions to the pores on the ‘left’ side of the domain, which is conveniently already labelled by the network generator.  We can assign a value of 1.0 to <em>all</em> the pores by passing in a scalar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now when we inspect the ‘pore.bc.value’ array we can see the 1.0 added to the specified locations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.  1.  1.  1. nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
<p>We can also specify a unique value for each pore by passing in an array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">num_pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">))</span><span class="o">*</span><span class="mf">10.0</span>
<span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">Exception</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">num_pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">))</span><span class="o">*</span><span class="mf">10.0</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>

<span class="nn">File ~/work/OpenPNM/OpenPNM/openpnm/algorithms/_transport.py:437,</span> in <span class="ni">Transport.set_value_BC</span><span class="nt">(self, pores, values, mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span> <span class="k">def</span> <span class="nf">set_value_BC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pores</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>     <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">419</span><span class="sd">     Applies constant value boundary conditons to the specified pores.</span>
<span class="g g-Whitespace">    </span><span class="mi">420</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">435</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">436</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">437</span>     <span class="bp">self</span><span class="o">.</span><span class="n">set_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pores</span><span class="p">,</span> <span class="n">bctype</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">bcvalues</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

<span class="nn">File ~/work/OpenPNM/OpenPNM/openpnm/algorithms/_reactive_transport.py:253,</span> in <span class="ni">ReactiveTransport.set_BC</span><span class="nt">(self, pores, bctype, bcvalues, mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>     <span class="k">pass</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span> <span class="c1"># Assign BCs if above check passes</span>
<span class="ne">--&gt; </span><span class="mi">253</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pores</span><span class="p">,</span> <span class="n">bctype</span><span class="o">=</span><span class="n">bctype</span><span class="p">,</span> <span class="n">bcvalues</span><span class="o">=</span><span class="n">bcvalues</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

<span class="nn">File ~/work/OpenPNM/OpenPNM/openpnm/algorithms/_algorithm.py:212,</span> in <span class="ni">Algorithm.set_BC</span><span class="nt">(self, pores, bctype, bcvalues, mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>  <span class="c1"># Raise exception if some conflicts found</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>         <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Some of the given locations already have BCs, &quot;</span> \
<span class="g g-Whitespace">    </span><span class="mi">210</span>             <span class="o">+</span> <span class="s2">&quot;either use mode=&#39;remove&#39; first or &quot;</span> \
<span class="g g-Whitespace">    </span><span class="mi">211</span>             <span class="o">+</span> <span class="s2">&quot;use mode=&#39;overwrite&#39; instead&quot;</span>
<span class="ne">--&gt; </span><span class="mi">212</span>         <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">213</span>     <span class="bp">self</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pore.bc.</span><span class="si">{</span><span class="n">bctype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">][</span><span class="n">pores</span><span class="p">[</span><span class="n">mask</span><span class="p">]]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span> <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>     <span class="c1"># Put given values in specified BC, sort out conflicts below</span>

<span class="ne">Exception</span>: Some of the given locations already have BCs, either use mode=&#39;remove&#39; first or use mode=&#39;overwrite&#39; instead
</pre></div>
</div>
</div>
</div>
<p>Printing the ‘pore.bc.value’ array again reveals a problem</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.         1.         1.         1.         1.80552279        nan
        nan        nan 6.4076432         nan        nan        nan
 1.79574885        nan        nan        nan]
</pre></div>
</div>
</div>
</div>
<p>Although we added values to 4 locations, only 3 were written, and the pre-existing values of 1.0 all remained. This is because we used <code class="docutils literal notranslate"><span class="pre">mode='add'</span></code> for both cases, which does <em>not</em> overwrite any pre-existing values. We need to remove the values from the locations first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;remove&#39;</span><span class="p">)</span>
<span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7.34913406 1.         1.         1.         1.80552279        nan
        nan        nan 6.4076432         nan        nan        nan
 1.79574885        nan        nan        nan]
</pre></div>
</div>
</div>
</div>
<p>Now we can see that the 1.0 in pore 0 has been filled with a random number.  There is a convenient short-cut for this using <code class="docutils literal notranslate"><span class="pre">mode='overwrite'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 2.  1.  1.  1.  2. nan nan nan  2. nan nan nan  2. nan nan nan]
</pre></div>
</div>
</div>
</div>
<p><strong>Pro Tip</strong>: The mode argument can be a list of modes, which are each applied in order, so the ‘overwrite’ behavior can be achieved with <code class="docutils literal notranslate"><span class="pre">mode=['remove',</span> <span class="pre">'add']</span></code>.  Another useful option may be to clear all existing values the adding new ones, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">values</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 2. nan nan nan  2. nan nan nan  2. nan nan nan  2. nan nan nan]
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-rate-boundary-conditions">
<h2>Adding Rate Boundary Conditions<a class="headerlink" href="#adding-rate-boundary-conditions" title="Permalink to this heading">#</a></h2>
<p>Adding rate boundary conditions is done in exactly the same manner as value conditions described above, but via the <code class="docutils literal notranslate"><span class="pre">set_rate_BC</span></code> method. One special consideration when using rate boundary conditions is that they <em>must</em> be combined with a value boundary condition. Therefore, in this section we’ll look at the situation of defining two different types of boundary conditions at the same time.</p>
<p>When applying rate conditions to pores without any pre-existing value condtions, there is no problem. However, if one wishes to overwrite value BCs with rate BCs (or vice-versa) special treatment is required. To add rate BCs to pores that already have rate BCs one just needs to use <code class="docutils literal notranslate"><span class="pre">mode='overwrite'</span></code>.  Howver, to add rate BCs to pores with <em>value</em> BCs then it is necessary to first remove the values from the target locations since value and rate conditions cannot exist in the same pores.</p>
<p>Firstly, let’s try to add rate BCs and note that nothing is written:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_rate_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;front&#39;</span><span class="p">),</span> <span class="n">rates</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.rate&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
    WARNING    : No valid pore locations were specified 
    SOURCE     : openpnm.algorithms._generic_algorithm.set_BC 
    TIME STAMP : 2022-07-02 18:20:12,999    
------------------------------------------------------------
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
<p>As can be seen the rate BCs were not written anywhere since value BCs were present in the given pores. If we first <code class="docutils literal notranslate"><span class="pre">remove</span></code> the values, then we can get the result we want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_value_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;remove&#39;</span><span class="p">)</span>
<span class="n">fd</span><span class="o">.</span><span class="n">set_rate_BC</span><span class="p">(</span><span class="n">pores</span><span class="o">=</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="n">rates</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.rate&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 2.  2.  2.  2. nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
</section>
<section id="removing-and-resetting-boundary-conditions">
<h2>Removing and Resetting Boundary Conditions<a class="headerlink" href="#removing-and-resetting-boundary-conditions" title="Permalink to this heading">#</a></h2>
<p>The above example illustrated how it was necessary to remove the value BCs from the target pores prior to adding the rate BCs. The required knowing which types were defined and each needed to be removed explicitly.  An alternative and more general approach is possible.</p>
<p><strong>Pro Tip</strong>: A list of BC types can be passed <code class="docutils literal notranslate"><span class="pre">set_BC</span></code>, which will each be handled in order. If the mode happens to be <code class="docutils literal notranslate"><span class="pre">clear</span></code>, then all the given bc types will be cleared.  Combining this with the dictionary trick used above makes it possible to remove all the bcs without knowing which types are present.  This is illustrated as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="o">.</span><span class="n">set_BC</span><span class="p">(</span><span class="n">bctype</span><span class="o">=</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;clear&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now all the bc arrays will be filled with <code class="docutils literal notranslate"><span class="pre">nan</span></code> meaning that no conditions are set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.rate&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan]
</pre></div>
</div>
</div>
</div>
<p><strong>Pro Tip</strong>: It is possible to edit the bc arrays directly if you know what you’re doing.  For instance, setting value BCs in the left and right pores can be done as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">][</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">][</span><span class="n">pn</span><span class="o">.</span><span class="n">pores</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</div>
</div>
<p>Running the algorithm will proceed as normal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soln</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">soln</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;pore.concentration&#39;: SteadyStateSolution([1.        , 1.        , 1.        , 1.        ,       
                     0.63288306, 0.61093419, 0.59883861, 0.65250284,
                     0.28088028, 0.21000019, 0.16882826, 0.26800406,
                     0.        , 0.        , 0.        , 0.        ])}
</pre></div>
</div>
</div>
</div>
<p>And of course, these bcs can be “reset” directly too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fd</span><span class="p">[</span><span class="s1">&#39;pore.bc.value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
</div>
<p>Where the above will expand the scalar value (i.e. <code class="docutils literal notranslate"><span class="pre">nan</span></code>) and apply it to all pores.</p>
</section>
</section>


              </article>
              

              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, PMEAL.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>